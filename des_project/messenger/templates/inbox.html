{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
    <h2 class="mb-4 text-center">ðŸ“¥ Há»™p thÆ°</h2>

    {% if error %}
        <div class="alert alert-danger text-center">{{ error }}</div>
    {% endif %}

    {% if messages %}
        {% for msg in messages %}
            <div class="card mb-3 shadow-sm {% if msg.is_sent %}border-primary{% else %}border-success{% endif %}">
                <div class="card-body">
                    <h6 class="card-subtitle mb-2 text-muted">
                        {{ msg.created_at|date:"d/m/Y H:i" }}
                    </h6>

                    {% if msg.is_sent %}
                        <p class="card-title text-primary">
                            Báº¡n Ä‘Ã£ gá»­i tá»›i <strong>{{ msg.to }}</strong>
                        </p>
                    {% else %}
                        <p class="card-title text-success">
                            <strong>{{ msg.from }}</strong> Ä‘Ã£ gá»­i cho báº¡n
                        </p>
                    {% endif %}

                    {% if decrypted_id == msg.id %}
                        {% if decrypted_text %}
                            <p class="card-text"><strong>Ná»™i dung:</strong> {{ decrypted_text }}</p>
                        {% endif %}
                        {% if decrypted_image %}
                            <div class="mt-2">
                                <p><strong>áº¢nh Ä‘Ã£ giáº£i mÃ£:</strong></p>
                                <img src="{{ decrypted_image }}" class="img-fluid rounded border" style="max-width: 300px;">
                            </div>
                        {% endif %}
                    {% else %}
                        <!-- Form nháº­p khÃ³a HEX -->
                        <form method="post" class="mt-2">
                            {% csrf_token %}
                            <input type="hidden" name="msg_id" value="{{ msg.id }}">
                            <div class="mb-2">
                                <input type="text" name="key" class="form-control"
                                       placeholder="Nháº­p khÃ³a HEX (16 kÃ½ tá»±)" maxlength="16"
                                       pattern="[0-9a-fA-F]{16}" required>
                                <small class="text-muted">Chá»‰ bao gá»“m kÃ½ tá»± 0â€“9, aâ€“f</small>
                            </div>
                            <button type="submit" class="btn btn-sm btn-outline-primary">Giáº£i mÃ£</button>
                        </form>
                    {% endif %}
                </div>
            </div>
        {% endfor %}
    {% else %}
        <div class="alert alert-info text-center">Báº¡n chÆ°a cÃ³ tin nháº¯n nÃ o.</div>
    {% endif %}
</div>
{% endblock %}
